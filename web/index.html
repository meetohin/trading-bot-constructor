<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Bank Trading Bot Constructor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f766e 0%, #059669 50%, #047857 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 20px;
        }

        .nav-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #6b7280;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #0f766e 0%, #047857 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(15, 118, 110, 0.4);
        }

        .nav-tab:hover:not(.active) {
            background: #f3f4f6;
            color: #374151;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }

        .form-section h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 20px;
            height: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #0f766e;
            box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.2);
        }

        .select-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .preset-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .preset-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .preset-card:hover {
            border-color: #0f766e;
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .preset-card.selected {
            border-color: #0f766e;
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.15) 0%, rgba(4, 120, 87, 0.15) 100%);
        }

        .preset-card h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1e293b;
        }

        .preset-card p {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .preset-performance {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }

        .performance-item {
            text-align: center;
        }

        .performance-value {
            font-weight: 600;
            color: #047857;
        }

        .performance-label {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0f766e 0%, #047857 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(15, 118, 110, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-success {
            background: rgba(4, 120, 87, 0.15);
            color: #047857;
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .logs-container {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .log-timestamp {
            color: #64748b;
        }

        .log-level-info {
            color: #3b82f6;
        }

        .log-level-success {
            color: #047857;
        }

        .log-level-warning {
            color: #f59e0b;
        }

        .log-level-error {
            color: #ef4444;
        }

        .help-section {
            background: #f8fafc;
            border-left: 4px solid #0f766e;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .help-section h4 {
            margin-bottom: 15px;
            color: #1e293b;
        }

        .help-section ul {
            list-style: none;
            padding-left: 0;
        }

        .help-section li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .help-section li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: #0f766e;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f766e, #047857);
            width: 0%;
            transition: width 0.3s ease;
        }

        .bots-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bot-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .bot-card.running {
            border-color: #059669;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.05) 0%, rgba(4, 120, 87, 0.05) 100%);
        }

        .bot-card.stopped {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
        }

        .bot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .bot-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .bot-controls {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .nav-tabs {
                flex-direction: column;
                gap: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .preset-cards {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>T-Bank Trading Bot Constructor</h1>
            <p>Создайте и настройте своего торгового робота за несколько минут</p>
        </header>

        <div class="main-content">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('presets')">
                    <span>📊</span> Готовые стратегии
                </button>
                <button class="nav-tab" onclick="switchTab('custom')">
                    <span>⚙️</span> Настройки
                </button>
                <button class="nav-tab" onclick="switchTab('control')">
                    <span>🚀</span> Управление
                </button>
                <button class="nav-tab" onclick="switchTab('instructions')">
                    <span>📖</span> Инструкции
                </button>
            </div>

            <!-- Готовые стратегии -->
            <div id="presets" class="tab-content active">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e293b;">Выберите готовую стратегию</h2>
                
                <div class="preset-cards">
                    <div class="preset-card" onclick="selectPreset('conservative')">
                        <h4>🛡️ Консервативная стратегия</h4>
                        <p>Низкорискованная стратегия на основе анализа стакана заявок. Подходит для начинающих трейдеров.</p>
                        <div class="preset-performance">
                            <div class="performance-item">
                                <div class="performance-value">Buy: 3.0</div>
                                <div class="performance-label">Коэфф. покупки</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-value">0.3%</div>
                                <div class="performance-label">Мин. профит</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-value">Глубина: 20</div>
                                <div class="performance-label">Уровней стакана</div>
                            </div>
                        </div>
                    </div>

                    <div class="preset-card" onclick="selectPreset('balanced')">
                        <h4>⚖️ Сбалансированная стратегия</h4>
                        <p>Оптимальное соотношение риска и доходности на стакане. Рекомендуется для большинства пользователей.</p>
                        <div class="preset-performance">
                            <div class="performance-item">
                                <div class="performance-value">Buy: 2.0</div>
                                <div class="performance-label">Коэфф. покупки</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-value">0.5%</div>
                                <div class="performance-label">Мин. профит</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-value">Глубина: 20</div>
                                <div class="performance-label">Уровней стакана</div>
                            </div>
                        </div>
                    </div>

                    <div class="preset-card" onclick="selectPreset('aggressive')">
                        <h4>🔥 Агрессивная стратегия</h4>
                        <p>Высокодоходная стратегия с быстрыми решениями на стакане. Для опытных трейдеров.</p>
                        <div class="preset-performance">
                            <div class="performance-item">
                                <div class="performance-value">Buy: 1.5</div>
                                <div class="performance-label">Коэфф. покупки</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-value">0.8%</div>
                                <div class="performance-label">Мин. профит</div>
                            </div>
                            <div class="performance-item">
                                <div class="performance-value">Глубина: 30</div>
                                <div class="performance-label">Уровней стакана</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="createBotFromPreset()">
                        <span>🤖</span> Создать бота
                    </button>
                    <button class="btn btn-secondary" onclick="switchTab('custom')">
                        <span>⚙️</span> Настроить вручную
                    </button>
                </div>

                <div class="help-section">
                    <h4>ℹ️ Информация о стратегиях</h4>
                    <ul>
                        <li>Все стратегии основаны на анализе стакана заявок</li>
                        <li>Боты торгуют при превышении заданного коэффициента bid/ask</li>
                        <li>Можно запускать несколько ботов одновременно</li>
                        <li>Рекомендуется начать с песочницы для тестирования</li>
                    </ul>
                </div>
            </div>

            <!-- Пользовательские настройки -->
            <div id="custom" class="tab-content">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e293b;">Настройте своего бота</h2>
                
                <div class="form-grid">
                    <div class="form-section">
                        <h3>
                            <span class="icon">🔐</span>
                            Основные настройки
                        </h3>
                        <div class="form-group">
                            <label for="bot-name">Название бота</label>
                            <input type="text" id="bot-name" class="form-control" placeholder="Мой торговый бот">
                        </div>
                        <div class="form-group">
                            <label for="account-select">Торговый аккаунт</label>
                            <select id="account-select" class="form-control select-control">
                                <option value="">Загрузка аккаунтов...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bot-instruments">Инструменты (FIGI через запятую)</label>
                            <input type="text" id="bot-instruments" class="form-control" placeholder="BBG004S681W1,BBG004730N88" value="BBG004S681W1">
                        </div>
                        <div class="form-group">
                            <label for="bot-currency">Валюта</label>
                            <select id="bot-currency" class="form-control select-control">
                                <option value="RUB">RUB - Российский рубль</option>
                                <option value="USD">USD - Доллар США</option>
                                <option value="EUR">EUR - Евро</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>
                            <span class="icon">📊</span>
                            Параметры стратегии на стакане
                        </h3>
                        <div class="form-group">
                            <label for="required-balance">Минимальный баланс (₽)</label>
                            <input type="number" id="required-balance" class="form-control" value="10000" min="1000">
                        </div>
                        <div class="form-group">
                            <label for="orderbook-depth">Глубина стакана</label>
                            <input type="number" id="orderbook-depth" class="form-control" value="20" min="5" max="50">
                        </div>
                        <div class="form-group">
                            <label for="buy-ratio">Коэффициент покупки</label>
                            <input type="number" id="buy-ratio" class="form-control" value="2.0" step="0.1" min="1.0">
                        </div>
                        <div class="form-group">
                            <label for="sell-ratio">Коэффициент продажи</label>
                            <input type="number" id="sell-ratio" class="form-control" value="2.0" step="0.1" min="1.0">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>
                            <span class="icon">💰</span>
                            Управление рисками
                        </h3>
                        <div class="form-group">
                            <label for="min-profit">Минимальная прибыль (%)</label>
                            <input type="number" id="min-profit" class="form-control" value="0.5" step="0.1" min="0.1">
                        </div>
                        <div class="form-group">
                            <label for="max-positions">Максимум позиций</label>
                            <input type="number" id="max-positions" class="form-control" value="5" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="sell-out" checked style="margin-right: 8px;">
                                Закрывать позиции при остановке
                            </label>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="createCustomBot()">
                        <span>🤖</span> Создать бота
                    </button>
                    <button class="btn btn-secondary" onclick="saveConfiguration()">
                        <span>💾</span> Сохранить настройки
                    </button>
                    <button class="btn btn-secondary" onclick="loadConfiguration()">
                        <span>📂</span> Загрузить настройки
                    </button>
                </div>
            </div>

            <!-- Управление ботом -->
            <div id="control" class="tab-content">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e293b;">Управление ботами</h2>
                
                <div class="form-section">
                    <h3>
                        <span class="icon">📊</span>
                        Системная информация
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <p><strong>Статус API:</strong> <span id="api-status">Проверка...</span></p>
                            <p><strong>Аккаунтов:</strong> <span id="accounts-count">0</span></p>
                        </div>
                        <div>
                            <p><strong>Активных ботов:</strong> <span id="active-bots">0</span></p>
                            <p><strong>Время работы:</strong> <span id="uptime">00:00:00</span></p>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>
                        <span class="icon">🤖</span>
                        Мои боты
                    </h3>
                    <div id="bots-list" class="bots-list">
                        <div style="text-align: center; color: #6b7280; padding: 40px;">
                            Боты не найдены. Создайте первого бота на вкладке "Готовые стратегии" или "Настройки"
                        </div>
                    </div>
                </div>

                <div class="logs-container" id="logs-container" style="display: none;">
                    <div id="logs-content">
                        <div class="log-entry">
                            <span class="log-timestamp">[2024-01-15 14:30:25]</span>
                            <span class="log-level-info">[INFO]</span>
                            Сервер торговых ботов запущен
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="toggleLogs()">
                        <span>📜</span> Показать/скрыть логи
                    </button>
                    <button class="btn btn-secondary" onclick="refreshBots()">
                        <span>🔄</span> Обновить список
                    </button>
                </div>

                <div class="help-section">
                    <h4>💡 Советы по управлению</h4>
                    <ul>
                        <li>Всегда тестируйте стратегию в песочнице перед запуском</li>
                        <li>Регулярно проверяйте логи для отслеживания работы бота</li>
                        <li>Устанавливайте разумные лимиты минимальной прибыли</li>
                        <li>Не запускайте бота с большими суммами без предварительного тестирования</li>
                    </ul>
                </div>
            </div>

            <!-- Инструкции -->
            <div id="instructions" class="tab-content">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e293b;">Подробная инструкция</h2>
                
                <div class="form-section">
                    <h3>🚀 Быстрый старт</h3>
                    <ol style="padding-left: 20px; line-height: 1.8;">
                        <li><strong>Зарегистрируйтесь</strong> в T-Bank Инвестиции</li>
                        <li><strong>Получите API токен</strong> в настройках личного кабинета</li>
                        <li><strong>Настройте config.yaml</strong> с вашим токеном на сервере</li>
                        <li><strong>Выберите готовую стратегию</strong> или настройте свою</li>
                        <li><strong>Создайте бота</strong> и запустите в песочнице</li>
                        <li><strong>После успешного тестирования</strong> переключитесь на продакшн</li>
                    </ol>
                </div>

                <div class="form-section">
                    <h3>🔐 Получение API токена</h3>
                    <ol style="padding-left: 20px; line-height: 1.8;">
                        <li>Зайдите в <a href="https://www.tbank.ru/invest/" target="_blank">T-Bank Инвестиции</a></li>
                        <li>Перейдите в раздел "Настройки"</li>
                        <li>Найдите раздел "API для разработчиков"</li>
                        <li>Отключите "Подтверждение сделок кодом"</li>
                        <li>Выпустите новый токен</li>
                        <li>Скопируйте токен (он показывается только один раз!
                        <li>Скопируйте токен (он показывается только один раз!)</li>
                        <li>Добавьте токен в файл config.yaml на сервере</li>
                    </ol>
                </div>

                <div class="form-section">
                    <h3>📊 Стратегия на стакане заявок</h3>
                    <div style="margin-bottom: 20px;">
                        <h4>Принцип работы</h4>
                        <p>Бот анализирует соотношение объемов заявок на покупку (bid) и продажу (ask) в стакане:</p>
                        <ul style="padding-left: 20px; line-height: 1.6;">
                            <li><strong>Покупка:</strong> Когда объем bid заявок больше ask заявок в buy_ratio раз</li>
                            <li><strong>Продажа:</strong> Когда объем ask заявок больше bid заявок в sell_ratio раз</li>
                            <li><strong>Проверки:</strong> Достаточность средств, отсутствие открытых позиций, минимальная прибыль</li>
                        </ul>
                        <div style="background: #e0f2fe; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <p><strong>Формула:</strong></p>
                            <p>• ratio = sum(bid_volumes) / sum(ask_volumes)</p>
                            <p>• Покупаем если: ratio > buy_ratio</p>
                            <p>• Продаем если: 1/ratio > sell_ratio</p>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>⚙️ Основные параметры</h3>
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <h4>Коэффициент покупки (buy_ratio)</h4>
                            <p>Во сколько раз объем bid заявок должен превышать ask для покупки. Рекомендуется: 1.5-3.0</p>
                        </div>
                        <div>
                            <h4>Коэффициент продажи (sell_ratio)</h4>
                            <p>Во сколько раз объем ask заявок должен превышать bid для продажи. Рекомендуется: 1.5-3.0</p>
                        </div>
                        <div>
                            <h4>Глубина стакана</h4>
                            <p>Количество уровней стакана для анализа объемов. Обычно 10-50 уровней.</p>
                        </div>
                        <div>
                            <h4>Минимальная прибыль (%)</h4>
                            <p>Минимальный процент прибыли для продажи позиции. Рекомендуется: 0.3-1.0%</p>
                        </div>
                        <div>
                            <h4>Минимальный баланс</h4>
                            <p>Необходимая сумма на счете для начала торговли в рублях.</p>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>🎯 Рекомендации по настройке</h3>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h4>Для начинающих:</h4>
                        <ul style="padding-left: 20px; line-height: 1.6;">
                            <li>Используйте консервативную стратегию</li>
                            <li>Начните с небольших сумм в песочнице</li>
                            <li>Установите высокие коэффициенты (2.5-3.0)</li>
                            <li>Торгуйте ликвидными инструментами (TCSG, SBER)</li>
                        </ul>
                    </div>
                    <div style="background: #d1f2eb; padding: 15px; border-radius: 8px; border-left: 4px solid #0f766e; margin-top: 15px;">
                        <h4>Для опытных трейдеров:</h4>
                        <ul style="padding-left: 20px; line-height: 1.6;">
                            <li>Экспериментируйте с низкими коэффициентами (1.2-1.8)</li>
                            <li>Используйте несколько ботов на разных инструментах</li>
                            <li>Анализируйте статистику для оптимизации параметров</li>
                            <li>Комбинируйте различные глубины стакана (10, 20, 50)</li>
                            <li>Тестируйте разные минимальные прибыли для каждого актива</li>
                        </ul>
                    </div>
                </div>

                <div class="form-section">
                    <h3>📈 Понимание статистики бота</h3>
                    <ul style="padding-left: 20px; line-height: 1.8;">
                        <li><strong>Всего сделок:</strong> Общее количество совершенных операций</li>
                        <li><strong>Прибыльных сделок:</strong> Количество и процент успешных операций</li>
                        <li><strong>Общая прибыль:</strong> Абсолютная прибыль в валюте торговли</li>
                        <li><strong>Время работы:</strong> Продолжительность активной работы бота</li>
                        <li><strong>Открытые позиции:</strong> Текущие незакрытые позиции</li>
                    </ul>
                </div>

                <div class="form-section">
                    <h3>⚠️ Важные предупреждения</h3>
                    <div style="background: #f8d7da; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                        <ul style="padding-left: 20px; line-height: 1.6; margin: 0;">
                            <li>Торговые роботы не гарантируют прибыль</li>
                            <li>Всегда используйте функцию закрытия позиций при остановке</li>
                            <li>Не вкладывайте больше, чем можете позволить себе потерять</li>
                            <li>Регулярно мониторьте работу бота</li>
                            <li>Рыночные условия могут кардинально измениться</li>
                        </ul>
                    </div>
                </div>

                <div class="form-section">
                    <h3>🔧 Техническая поддержка</h3>
                    <p>При возникновении вопросов или проблем:</p>
                    <ul style="padding-left: 20px; line-height: 1.8;">
                        <li>Проверьте логи на наличие ошибок</li>
                        <li>Убедитесь в правильности настройки config.yaml</li>
                        <li>Проверьте интернет-соединение сервера</li>
                        <li>Обратитесь к <a href="https://github.com/Tinkoff/invest-api-go-sdk" target="_blank">документации API</a></li>
                        <li>Присоединяйтесь к <a href="https://t.me/joinchat/VaW05CDzcSdsPULM" target="_blank">Telegram-чату разработчиков</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal для прогресса -->
    <div id="progressModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Выполнение операции...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="modalMessage">Инициализация...</p>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal()" id="modalCloseBtn" style="display: none;">Закрыть</button>
            </div>
        </div>
    </div>



    <script>
        // Глобальные переменные
        let selectedPreset = null;
        let currentConfig = {};
        let bots = {};
        let accounts = [];
        let startTime = Date.now();

        // API базовый URL
        const API_BASE = '/api/v1';

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            loadAccounts();
            loadBots();
            checkApiStatus();
            updateUptime();

            // Обновляем данные периодически
            setInterval(checkApiStatus, 30000);
            setInterval(updateUptime, 1000);
            setInterval(loadBots, 10000);

            // Попытка загрузить сохраненную конфигурацию
            const savedConfig = localStorage.getItem('tradingBotConfig');
            if (savedConfig) {
                currentConfig = JSON.parse(savedConfig);
                showNotification('Загружена сохраненная конфигурация', 'success');
            }
        });

        // Переключение вкладок
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Выбор пресета стратегии
        function selectPreset(preset) {
            document.querySelectorAll('.preset-card').forEach(card => {
                card.classList.remove('selected');
            });

            event.target.closest('.preset-card').classList.add('selected');
            selectedPreset = preset;
            loadPresetConfig(preset);
        }

        // Загрузка конфигурации пресета
        function loadPresetConfig(preset) {
            const presets = {
                conservative: {
                    'required-balance': 10000,
                    'orderbook-depth': 20,
                    'buy-ratio': 3.0,
                    'sell-ratio': 3.0,
                    'min-profit': 0.3,
                    'max-positions': 3,
                    'sell-out': true
                },
                balanced: {
                    'required-balance': 20000,
                    'orderbook-depth': 20,
                    'buy-ratio': 2.0,
                    'sell-ratio': 2.0,
                    'min-profit': 0.5,
                    'max-positions': 5,
                    'sell-out': true
                },
                aggressive: {
                    'required-balance': 50000,
                    'orderbook-depth': 30,
                    'buy-ratio': 1.5,
                    'sell-ratio': 1.5,
                    'min-profit': 0.8,
                    'max-positions': 8,
                    'sell-out': true
                }
            };

            const config = presets[preset];
            if (config) {
                Object.keys(config).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = config[key];
                        } else {
                            element.value = config[key];
                        }
                    }
                });
                currentConfig = config;
            }
        }

        // Создание бота из пресета
        async function createBotFromPreset() {
            if (!selectedPreset) {
                showNotification('Выберите стратегию', 'warning');
                return;
            }

            if (accounts.length === 0) {
                showNotification('Сначала загрузите аккаунты', 'warning');
                return;
            }

            showModal('Создание бота', 'Создание бота из выбранной стратегии...');

            const presetNames = {
                conservative: 'Консервативный бот',
                balanced: 'Сбалансированный бот',
                aggressive: 'Агрессивный бот'
            };

            const botConfig = {
                name: presetNames[selectedPreset],
                type: 'orderbook',
                account_id: accounts[0],
                instruments: ['BBG004S681W1'], // TCSG по умолчанию
                currency: 'RUB',
                orderbook_config: {
                    required_money_balance: currentConfig['required-balance'],
                    depth: currentConfig['orderbook-depth'],
                    buy_ratio: currentConfig['buy-ratio'],
                    sell_ratio: currentConfig['sell-ratio'],
                    min_profit: currentConfig['min-profit'],
                    sell_out: currentConfig['sell-out'],
                    max_positions: currentConfig['max-positions']
                }
            };

            try {
                const response = await fetch(`${API_BASE}/bots`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'demo-api-key'
                    },
                    body: JSON.stringify(botConfig)
                });

                const result = await response.json();

                if (response.ok) {
                    closeModal();
                    showNotification(`Бот "${botConfig.name}" создан успешно!`, 'success');
                    loadBots();
                    switchTab('control');
                } else {
                    closeModal();
                    showNotification(`Ошибка создания бота: ${result.error}`, 'error');
                }
            } catch (error) {
                closeModal();
                showNotification(`Ошибка создания бота: ${error.message}`, 'error');
            }
        }

        // Создание пользовательского бота
        async function createCustomBot() {
            const botName = document.getElementById('bot-name').value;
            const accountId = document.getElementById('account-select').value;
            const instruments = document.getElementById('bot-instruments').value.split(',').map(s => s.trim());
            const currency = document.getElementById('bot-currency').value;

            if (!botName || !accountId || !instruments[0]) {
                showNotification('Заполните все обязательные поля', 'warning');
                return;
            }

            showModal('Создание бота', 'Создание пользовательского бота...');

            const botConfig = {
                name: botName,
                type: 'orderbook',
                account_id: accountId,
                instruments: instruments,
                currency: currency,
                orderbook_config: {
                    required_money_balance: parseFloat(document.getElementById('required-balance').value),
                    depth: parseInt(document.getElementById('orderbook-depth').value),
                    buy_ratio: parseFloat(document.getElementById('buy-ratio').value),
                    sell_ratio: parseFloat(document.getElementById('sell-ratio').value),
                    min_profit: parseFloat(document.getElementById('min-profit').value),
                    sell_out: document.getElementById('sell-out').checked,
                    max_positions: parseInt(document.getElementById('max-positions').value)
                }
            };

            try {
                const response = await fetch(`${API_BASE}/bots`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'demo-api-key'
                    },
                    body: JSON.stringify(botConfig)
                });

                const result = await response.json();

                if (response.ok) {
                    closeModal();
                    showNotification(`Бот "${botConfig.name}" создан успешно!`, 'success');
                    loadBots();
                    switchTab('control');
                } else {
                    closeModal();
                    showNotification(`Ошибка создания бота: ${result.error}`, 'error');
                }
            } catch (error) {
                closeModal();
                showNotification(`Ошибка создания бота: ${error.message}`, 'error');
            }
        }

        // Загрузка аккаунтов
        async function loadAccounts() {
            try {
                const response = await fetch(`${API_BASE}/accounts`, {
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });
                const data = await response.json();

                accounts = data.accounts || [];
                updateAccountSelect();
                document.getElementById('accounts-count').textContent = accounts.length;

                logMessage(`Загружено аккаунтов: ${accounts.length}`, 'info');
            } catch (error) {
                logMessage('Ошибка загрузки аккаунтов: ' + error.message, 'error');
            }
        }

        // Обновление селектора аккаунтов
        function updateAccountSelect() {
            const select = document.getElementById('account-select');
            select.innerHTML = '<option value="">Выберите аккаунт</option>';

            accounts.forEach(accountId => {
                const option = document.createElement('option');
                option.value = accountId;
                option.textContent = accountId;
                select.appendChild(option);
            });
        }

        // Загрузка ботов
        async function loadBots() {
            try {
                const response = await fetch(`${API_BASE}/bots`, {
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });
                const data = await response.json();

                bots = data.bots || {};
                updateBotsDisplay();
                updateActiveBots();
            } catch (error) {
                logMessage('Ошибка загрузки ботов: ' + error.message, 'error');
            }
        }

        // Обновление отображения ботов
        function updateBotsDisplay() {
            const container = document.getElementById('bots-list');

            if (Object.keys(bots).length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #6b7280; padding: 40px;">
                        Боты не найдены. Создайте первого бота на вкладке "Готовые стратегии" или "Настройки"
                    </div>
                `;
                return;
            }

            container.innerHTML = Object.entries(bots).map(([id, bot]) => {
                const statusClass = bot.is_active ? 'running' : 'stopped';
                const statusText = bot.is_active ? 'Работает' : 'Остановлен';
                const statusIcon = bot.is_active ? '✅' : '⏸️';

                return `
                    <div class="bot-card ${statusClass}">
                        <div class="bot-header">
                            <div class="bot-name">${bot.name || bot.id}</div>
                            <div class="status-indicator status-${bot.is_active ? 'success' : 'warning'}">
                                <span>${statusIcon}</span> ${statusText}
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <p><strong>Тип:</strong> Бот на стакане</p>
                            <p><strong>Инструменты:</strong> ${bot.instruments.join(', ')}</p>
                            <p><strong>Аккаунт:</strong> ${bot.account_id}</p>
                        </div>
                        <div class="bot-controls">
                            ${bot.is_active ?
                    `<button class="btn btn-danger btn-small" onclick="stopBot('${id}')">Стоп</button>
                                 <button class="btn btn-secondary btn-small" onclick="pauseBot('${id}')">Пауза</button>` :
                    `<button class="btn btn-success btn-small" onclick="startBot('${id}')">Старт</button>`
                }
                            <button class="btn btn-secondary btn-small" onclick="showBotStats('${id}')">Статистика</button>
                            <button class="btn btn-danger btn-small" onclick="deleteBot('${id}')">Удалить</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Управление ботами
        async function startBot(botId) {
            try {
                const response = await fetch(`${API_BASE}/bots/${botId}/start`, {
                    method: 'POST',
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification(`Бот ${botId} запущен`, 'success');
                    logMessage(`Бот ${botId} запущен`, 'success');
                    loadBots();
                } else {
                    showNotification(`Ошибка запуска бота: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`Ошибка запуска бота: ${error.message}`, 'error');
            }
        }

        async function stopBot(botId) {
            try {
                const response = await fetch(`${API_BASE}/bots/${botId}/stop`, {
                    method: 'POST',
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification(`Бот ${botId} остановлен`, 'success');
                    logMessage(`Бот ${botId} остановлен`, 'success');
                    loadBots();
                } else {
                    showNotification(`Ошибка остановки бота: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`Ошибка остановки бота: ${error.message}`, 'error');
            }
        }

        async function pauseBot(botId) {
            try {
                const response = await fetch(`${API_BASE}/bots/${botId}/pause`, {
                    method: 'POST',
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification(`Бот ${botId} приостановлен`, 'success');
                    loadBots();
                } else {
                    showNotification(`Ошибка приостановки бота: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`Ошибка приостановки бота: ${error.message}`, 'error');
            }
        }

        async function deleteBot(botId) {
            if (!confirm('Вы уверены что хотите удалить этого бота?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/bots/${botId}`, {
                    method: 'DELETE',
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification(`Бот ${botId} удален`, 'success');
                    logMessage(`Бот ${botId} удален`, 'info');
                    loadBots();
                } else {
                    showNotification(`Ошибка удаления бота: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`Ошибка удаления бота: ${error.message}`, 'error');
            }
        }

        async function showBotStats(botId) {
            try {
                const response = await fetch(`${API_BASE}/bots/${botId}/stats`, {
                    headers: {
                        'X-API-Key': 'demo-api-key'
                    }
                });

                const stats = await response.json();

                if (response.ok) {
                    const message = `
Статистика бота ${botId}:
• Всего сделок: ${stats.total_trades}
• Прибыльных: ${stats.winning_trades}
• Убыточных: ${stats.losing_trades}
• Общая прибыль: ${stats.total_profit.toFixed(2)} ₽
• Процент прибыльности: ${stats.total_profit_pct.toFixed(1)}%
• Время работы: ${formatDuration(stats.running_time)}
• Открытых позиций: ${Object.keys(stats.current_positions).length}
                    `;
                    alert(message);
                } else {
                    showNotification(`Ошибка получения статистики: ${stats.error}`, 'error');
                }
            } catch (error) {
                showNotification(`Ошибка получения статистики: ${error.message}`, 'error');
            }
        }

        // Вспомогательные функции
        function formatDuration(nanoseconds) {
            const seconds = Math.floor(nanoseconds / 1000000000);
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();

                document.getElementById('api-status').textContent = data.status === 'running' ? 'Работает' : 'Недоступен';
            } catch (error) {
                document.getElementById('api-status').textContent = 'Ошибка';
                logMessage('Ошибка подключения к API: ' + error.message, 'error');
            }
        }

        function updateUptime() {
            const uptime = Date.now() - startTime;
            const hours = Math.floor(uptime / 3600000);
            const minutes = Math.floor((uptime % 3600000) / 60000);
            const seconds = Math.floor((uptime % 60000) / 1000);

            document.getElementById('uptime').textContent =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateActiveBots() {
            const activeCount = Object.values(bots).filter(bot => bot.is_active).length;
            document.getElementById('active-bots').textContent = activeCount;
        }

        function refreshBots() {
            loadBots();
            showNotification('Список ботов обновлен', 'success');
        }

        function toggleLogs() {
            const logsContainer = document.getElementById('logs-container');
            logsContainer.style.display = logsContainer.style.display === 'none' ? 'block' : 'none';
        }

        function logMessage(message, level = 'info') {
            const logsContent = document.getElementById('logs-content');
            const timestamp = new Date().toLocaleString('ru-RU');

            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                ${message}
            `;

            logsContent.appendChild(logEntry);
            logsContent.scrollTop = logsContent.scrollHeight;

            // Ограничиваем количество логов
            const logs = logsContent.children;
            if (logs.length > 100) {
                logsContent.removeChild(logs[0]);
            }
        }

        // Сохранение и загрузка конфигурации
        function saveConfiguration() {
            const config = {
                botName: document.getElementById('bot-name').value,
                accountId: document.getElementById('account-select').value,
                instruments: document.getElementById('bot-instruments').value,
                currency: document.getElementById('bot-currency').value,
                requiredBalance: document.getElementById('required-balance').value,
                orderbookDepth: document.getElementById('orderbook-depth').value,
                buyRatio: document.getElementById('buy-ratio').value,
                sellRatio: document.getElementById('sell-ratio').value,
                minProfit: document.getElementById('min-profit').value,
                maxPositions: document.getElementById('max-positions').value,
                sellOut: document.getElementById('sell-out').checked
            };

            localStorage.setItem('tradingBotConfig', JSON.stringify(config));
            showNotification('Конфигурация сохранена успешно!', 'success');
        }

        function loadConfiguration() {
            const savedConfig = localStorage.getItem('tradingBotConfig');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);

                Object.keys(config).forEach(key => {
                    const elementId = key.replace(/([A-Z])/g, '-$1').toLowerCase();
                    const element = document.getElementById(elementId);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = config[key];
                        } else {
                            element.value = config[key];
                        }
                    }
                });

                showNotification('Конфигурация загружена успешно!', 'success');
            } else {
                showNotification('Сохраненная конфигурация не найдена', 'warning');
            }
        }

        // Модальные окна
        function showModal(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('modalCloseBtn').style.display = 'none';
            document.getElementById('progressModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('progressModal').classList.remove('show');
        }

        // Уведомления
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.animation = 'slideIn 0.3s ease';

            switch (type) {
                case 'success':
                    notification.style.background = '#047857';
                    break;
                case 'warning':
                    notification.style.background = '#f59e0b';
                    break;
                case 'error':
                    notification.style.background = '#ef4444';
                    break;
                default:
                    notification.style.background = '#3b82f6';
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Закрытие модального окна при клике вне его
        window.onclick = function(event) {
            const modal = document.getElementById('progressModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Обработка клавиши Escape для закрытия модального окна
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>